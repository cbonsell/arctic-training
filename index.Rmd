---
title: "A Webpage"
author: "Christina Bonsell"
date: "October 10, 2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = F, message = F}
library(tidyverse)
library(cowplot)
library(scales)
library(DT)
library(leaflet)
```

```{r readfile}
esc <- read.csv(url("https://knb.ecoinformatics.org/knb/d1/mn/v2/object/urn%3Auuid%3Af119a05b-bbe7-4aea-93c6-85434dcb1c5e", method = "libcurl"), stringsAsFactors = F)
```


# Calculate Annual Escapement for Salmon Species
```{r, results="hide"}
annual_esc <- esc %>% 
  separate(sampleDate, c("Year","month","Day"), sep = "-", remove = F) %>% 
  mutate(Year = as.numeric(Year)) %>% 
  group_by(Species, SASAP.Region, Year) %>% 
  summarize(total_escapement = sum(DailyCount, na.rm=T)) %>% 
  filter(Species %in% c("Chinook","Sockeye","Chum", "Pink","Coho"))

head(annual_esc)
```

# Visulaize Escapement

Total Escapement by Region and Species

```{r, echo = F}
theme_set(theme_cowplot())


ggplot(annual_esc, aes(Species, total_escapement, fill=SASAP.Region))+
  geom_col(position=position_dodge())
```
Kodiak escapement over time by species

```{r echo = F}
my_theme <- theme_bw() +
  theme(legend.position = "bottom")

annual_esc %>%
  filter(SASAP.Region == "Kodiak") %>% 
  ggplot(aes(Year, total_escapement, color = Species))+
  geom_point()+
  geom_line()+
  scale_color_brewer(palette = "Dark2")+
  ylab("Escapement (no. fish)")+
  ggtitle("Kodiak Salmon Escapement")+
  my_theme


```

Escapement over time: all regions

```{r}
fig1 <- ggplot(annual_esc, aes(Year, total_escapement, color = Species))+
  geom_point()+
  geom_line()+
  facet_wrap(~SASAP.Region, scales = "free_y")

fig1

ggsave("escapement.png", fig1, width = 12, height = 7, units ="in")
```


# Map Sampling Locations

Create table with unique sampling locations, latitudes, and logitudes

```{r}
locations <- esc %>% 
  distinct(Location, Latitude, Longitude) %>% 
  drop_na()
```

```{r}
datatable(locations)
```

